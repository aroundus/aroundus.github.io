{
    "componentChunkName": "component---src-components-template-post-template-tsx",
    "path": "/kubernetes/deploy-project/",
    "result": {"data":{"site":{"siteMetadata":{"title":"AROUND US"}},"markdownRemark":{"id":"41ed7fb8-dd4d-5965-ab4f-5b0a1c059231","excerpt":"목차 IAM 정책 연결 테이블 생성 오브젝트 배포 IAM 정책 연결 IAM - 역할 - <your-cluster-name> 항목을 검색해서 NodeInstanceRole 단어를 포함하는 역할에 ingressController-iam-policy 정책을 연결하세요.  테이블 생성 RDS…","html":"<h2 id=\"목차\" style=\"position:relative;\">목차<a href=\"#%EB%AA%A9%EC%B0%A8\" aria-label=\"목차 permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<ol>\n<li><a href=\"#IAM-%EC%A0%95%EC%B1%85-%EC%97%B0%EA%B2%B0\">IAM 정책 연결</a></li>\n<li><a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%83%9D%EC%84%B1\">테이블 생성</a></li>\n<li><a href=\"#%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8-%EB%B0%B0%ED%8F%AC\">오브젝트 배포</a></li>\n</ol>\n<h2 id=\"IAM-정책-연결\" style=\"position:relative;\">IAM 정책 연결<a href=\"#IAM-%EC%A0%95%EC%B1%85-%EC%97%B0%EA%B2%B0\" aria-label=\"IAM 정책 연결 permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p>IAM - 역할 - <code>&#x3C;your-cluster-name></code> 항목을 검색해서 <code>NodeInstanceRole</code> 단어를 포함하는 역할에 <code>ingressController-iam-policy</code> 정책을 연결하세요.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1155px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/84fda6e7caca321ee14860650cc91757/010af/attach-policy-for-ingress-controller.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.41666666666667%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/84fda6e7caca321ee14860650cc91757/010af/attach-policy-for-ingress-controller.jpg\"\n        srcset=\"/static/84fda6e7caca321ee14860650cc91757/a3e66/attach-policy-for-ingress-controller.jpg 480w,\n/static/84fda6e7caca321ee14860650cc91757/fb816/attach-policy-for-ingress-controller.jpg 960w,\n/static/84fda6e7caca321ee14860650cc91757/010af/attach-policy-for-ingress-controller.jpg 1155w\"\n        sizes=\"(max-width: 1155px) 100vw, 1155px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"테이블-생성\" style=\"position:relative;\">테이블 생성<a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%83%9D%EC%84%B1\" aria-label=\"테이블 생성 permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p>RDS 데이터베이스에 테이블을 생성하기 위해 <code>kubectl port-forward</code> 명령어로 maxscale 파드를 선택해 포트 포워딩을 한 다음 로컬에서 작업합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"command-line-prompt\"><span data-user=sally data-host=localhost></span></span>kubectl port-forward service/maxscale <span class=\"token number\">4006</span>:4006 --namespace<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-namespace<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 730px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/41013038bd9cd59e00efe10cdd53ef7e/899a9/port-forward-maxscale.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.375000000000002%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/41013038bd9cd59e00efe10cdd53ef7e/899a9/port-forward-maxscale.jpg\"\n        srcset=\"/static/41013038bd9cd59e00efe10cdd53ef7e/a3e66/port-forward-maxscale.jpg 480w,\n/static/41013038bd9cd59e00efe10cdd53ef7e/899a9/port-forward-maxscale.jpg 730w\"\n        sizes=\"(max-width: 730px) 100vw, 730px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>파드의 포트를 로컬 포트로 포워딩한 상태입니다. 데이터베이스 툴을 사용하여 직접 데이터베이스에 접속해 봅시다. (필자는 <a href=\"https://dbeaver.io/download/\"><code>DBeaver</code></a> 툴을 사용하였습니다.)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1120px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b94cd59dd01340ae6adae6007da3f48b/811cd/mariadb-connection-settings.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.66666666666667%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/b94cd59dd01340ae6adae6007da3f48b/811cd/mariadb-connection-settings.jpg\"\n        srcset=\"/static/b94cd59dd01340ae6adae6007da3f48b/a3e66/mariadb-connection-settings.jpg 480w,\n/static/b94cd59dd01340ae6adae6007da3f48b/fb816/mariadb-connection-settings.jpg 960w,\n/static/b94cd59dd01340ae6adae6007da3f48b/811cd/mariadb-connection-settings.jpg 1120w\"\n        sizes=\"(max-width: 1120px) 100vw, 1120px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>데이터베이스 접속을 완료하였습니다. 이제 데이터베이스에 마이그레이션 및 다양한 작업을 수행할 수 있습니다.</p>\n<h2 id=\"오브젝트-배포\" style=\"position:relative;\">오브젝트 배포<a href=\"#%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8-%EB%B0%B0%ED%8F%AC\" aria-label=\"오브젝트 배포 permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<h3 id=\"Deployment\" style=\"position:relative;\">Deployment<a href=\"#Deployment\" aria-label=\"Deployment permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h3>\n<p><strong>Deployment</strong>(디플로이먼트) 오브젝트는 파드와 레플리카셋에 대한 선언적 업데이트를 제공합니다. 자세한 정보는 쿠버네티스 공식 문서의 <a href=\"https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/\">디플로이먼트</a> 내용을 참조하세요.</p>\n<p><code>containers</code> 필드에 컨테이너 이미지에 대한 정보를 입력합니다. 자세한 정보는 쿠버네티스 공식 문서의 <a href=\"https://kubernetes.io/ko/docs/concepts/containers/#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%9D%B4%EB%AF%B8%EC%A7%80\">컨테이너 이미지</a> 내용을 참조하세요.</p>\n<ul>\n<li><code>image</code>: 컨테이너가 항상 같은 버전의 이미지를 사용하도록 하기 위해 <code>&#x3C;image>:&#x3C;digest></code> 형태의 <strong>다이제스트</strong> 정보를 명시하는 것이 좋습니다. 다이제스트는 특정 버전의 이미지를 고유하게 식별하며 다이제스트 값을 변경하지 않는 한 쿠버네티스에 의해 절대로 변경되지 않습니다.</li>\n<li><code>imagePullPolicy</code>: 이미지 Pull(풀) 정책을 설정합니다.\n<ul>\n<li><code>IfNotPresent</code>: 이미지가 로컬에 이미 존재하지 않으면 이미지 풀을 시도합니다.</li>\n<li><code>Always</code>: 파드가 시작될 때마다 이미지 풀을 시도합니다.</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>운영(Production) 환경에서 컨테이너를 생성할 때 <code>:latest</code> 태그의 사용은 실행 중인 이미지를 추적하거나 롤백할 때 어려움이 있어 추천하지 않습니다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> collector\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> collector\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> collector\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> collector\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> collector\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> &lt;id<span class=\"token punctuation\">></span>/&lt;project<span class=\"token punctuation\">></span><span class=\"token punctuation\">:</span>&lt;digest<span class=\"token punctuation\">-</span>of<span class=\"token punctuation\">-</span>the<span class=\"token punctuation\">-</span>image<span class=\"token punctuation\">></span>\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> &lt;IfNotPresent<span class=\"token punctuation\">|</span>Always<span class=\"token punctuation\">></span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 200m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 1Gi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 1000m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 1Gi\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SPRING_PROFILES_ACTIVE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;local|development|production>\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> FMS_KAFKA_BROKER_LIST\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"kafka:9092\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SPRING_DATASOURCE_JDBC_URL\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"jdbc:log4jdbc:mysql://mariadb:3306/&lt;database-name>?autoReconnect=true&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;serverTimezone=Asia/Seoul\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> NEW_RELIC_AGENT_ENABLED\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SPRING_DATASOURCE_USERNAME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;mariadb-username>\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SPRING_DATASOURCE_PASSWORD\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;mariadb-password>\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> SPRING_DATASOURCE_MAXIMUM_POOL_SIZE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"30\"</span>\n      <span class=\"token key atrule\">imagePullSecrets</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dockerhub</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><img src=\"https://user-images.githubusercontent.com/16731356/82756835-920d4100-9e17-11ea-99da-b0dc046a3ff5.gif\" alt=\"apply-collector\"></p>\n<h3 id=\"Ingress\" style=\"position:relative;\">Ingress<a href=\"#Ingress\" aria-label=\"Ingress permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h3>\n<p><strong>Ingress</strong>(인그레스) 오브젝트는 서비스에 대한 로드 밸런서를 생성하고 웹 사이트에 대한 트래픽을 인스턴스 간에 분산할 수 있도록 합니다. 다음과 같이 오브젝트를 구성하고 배포하세요.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> extensions/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>service<span class=\"token punctuation\">-</span>name<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kubernetes.io/ingress.class</span><span class=\"token punctuation\">:</span> alb\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/certificate-arn</span><span class=\"token punctuation\">:</span> arn<span class=\"token punctuation\">:</span>aws<span class=\"token punctuation\">:</span>acm<span class=\"token punctuation\">:</span>ap<span class=\"token punctuation\">-</span>northeast<span class=\"token punctuation\">-</span>2<span class=\"token punctuation\">:</span>050914238222<span class=\"token punctuation\">:</span>certificate/f47dc907<span class=\"token punctuation\">-</span>3e20<span class=\"token punctuation\">-</span>4eba<span class=\"token punctuation\">-</span>9a37<span class=\"token punctuation\">-</span>71c039a9c28f\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/listen-ports</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'[{\"HTTP\":80},{\"HTTPS\":443}]'</span>\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/scheme</span><span class=\"token punctuation\">:</span> internet<span class=\"token punctuation\">-</span>facing\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/subnets</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>subnet<span class=\"token punctuation\">-</span>id<span class=\"token punctuation\">-</span>1<span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> &lt;your<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>subnet<span class=\"token punctuation\">-</span>id<span class=\"token punctuation\">-</span>2<span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> &lt;your<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>subnet<span class=\"token punctuation\">-</span>id<span class=\"token punctuation\">-</span>3<span class=\"token punctuation\">></span>\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/security-groups</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>security<span class=\"token punctuation\">-</span>group<span class=\"token punctuation\">-</span>id<span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> &lt;your<span class=\"token punctuation\">-</span>cluster<span class=\"token punctuation\">-</span>shared<span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span>security<span class=\"token punctuation\">-</span>group<span class=\"token punctuation\">-</span>id<span class=\"token punctuation\">></span><span class=\"token punctuation\">,</span> &lt;your<span class=\"token punctuation\">-</span>nodegroup<span class=\"token punctuation\">-</span>security<span class=\"token punctuation\">-</span>group<span class=\"token punctuation\">-</span>id<span class=\"token punctuation\">></span>\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/tags</span><span class=\"token punctuation\">:</span> Env=Dev\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/healthcheck-path</span><span class=\"token punctuation\">:</span> /health\n    <span class=\"token key atrule\">alb.ingress.kubernetes.io/load-balancer-attributes</span><span class=\"token punctuation\">:</span> idle_timeout.timeout_seconds=600\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>service<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>host<span class=\"token punctuation\">></span>\n      <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /api/*\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> api\n              <span class=\"token key atrule\">servicePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /*\n            <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> web\n              <span class=\"token key atrule\">servicePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Route 53 - 호스팅 영역 - <code>&#x3C;your-domain></code> - 레코드 세트 생성 - <code>&#x3C;your-service-server-host></code> 이름의 레코드를 생성합니다. 별칭으로 이전 단계에서 생성한 로드 밸런서를 선택합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1140px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d603fb6eda776730bc5ba663843c4b03/06dbb/create-route-53-record-set.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.125%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/d603fb6eda776730bc5ba663843c4b03/06dbb/create-route-53-record-set.jpg\"\n        srcset=\"/static/d603fb6eda776730bc5ba663843c4b03/a3e66/create-route-53-record-set.jpg 480w,\n/static/d603fb6eda776730bc5ba663843c4b03/fb816/create-route-53-record-set.jpg 960w,\n/static/d603fb6eda776730bc5ba663843c4b03/06dbb/create-route-53-record-set.jpg 1140w\"\n        sizes=\"(max-width: 1140px) 100vw, 1140px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"Service\" style=\"position:relative;\">Service<a href=\"#Service\" aria-label=\"Service permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h3>\n<p>네트워크 서비스로 노출이 필요한 클라이언트 프로젝트 파드는 Deployment 오브젝트 외에 추상적 개념인 <strong>Service</strong>(서비스) 오브젝트를 같이 구성해야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> api\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> api\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> api\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> api\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> api\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> api\n  <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">rollingUpdate</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">maxSurge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n      <span class=\"token key atrule\">maxUnavailable</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n  <span class=\"token key atrule\">minReadySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> api\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">...</span>\n      <span class=\"token key atrule\">imagePullSecrets</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dockerhub</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>오브젝트를 배포한 다음 호스트와 로드 밸런서의 엔드포인트 주소의 연결 상태를 확인하세요. <code>ADDRESS</code> 필드에 값이 있으면 정상적으로 연결된 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"command-line-prompt\"><span data-user=sally data-host=localhost></span></span>kubectl get ingresses --namespace<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-namespace<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 730px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/adfd0c9f4a4e7b6e08c2b7ec079dcb03/899a9/get-ingresses.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.166666666666664%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/adfd0c9f4a4e7b6e08c2b7ec079dcb03/899a9/get-ingresses.jpg\"\n        srcset=\"/static/adfd0c9f4a4e7b6e08c2b7ec079dcb03/a3e66/get-ingresses.jpg 480w,\n/static/adfd0c9f4a4e7b6e08c2b7ec079dcb03/899a9/get-ingresses.jpg 730w\"\n        sizes=\"(max-width: 730px) 100vw, 730px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>로드 밸런서 전파에는 다소 시간이 소요됩니다. 따라서 <em>- 필자는 5분 안에 값이 들어왔지만 몇 시간이 지나도 -</em> <code>ADDRESS</code> 필드에 엔드포인트 값이 없을 수 있습니다. 호스팅의 경우 쿠버네티스에서 관리하지 않는 AWS 서비스로 요청 시 바로 처리가 되지 않는 점에 유의하세요.</p>\n<p>(+) <em>- 필자의 경험에 의하면 -</em> <code>Unhealthy</code> 경고를 표시하더라도 <code>paths</code> 필드에 해당하는 오브젝트를 배포하면 주소를 찾으면서 엔드포인트 값이 들어오는 것으로 보입니다.</p>\n</blockquote>\n<h1>마치며</h1>\n<p>지금까지 2020년 모빌리티 스타트업에서 근무할 때 적용한 Amazon EKS 구성에 대한 핵심적인 내용을 공유하였습니다. Amazon EKS 서비스는 버전 업데이트가 활발하고 버전 간에 <strong>BREAKING CHANGE</strong>가 빈번하게 발생하는 편이기 때문에 최신 버전에서 위 내용에 맞춰 구성할 경우 실패할 수 있습니다. 꼭 다양한 레퍼런스를 참조해서 구성하세요.</p>","frontmatter":{"category":"kubernetes","index":6,"title":"Amazon EKS 프로젝트 배포하기","description":"프로젝트를 배포하는 방식은 사용하는 기술에 따라 다르겠지만 전체적인 뼈대는 비슷합니다. 실전에서 어떻게 배포했는지 살펴보세요.","image":"https://github.com/aroundus/aroundus.github.io/blob/master/posts/kubernetes/build-eks-infrastructure/cover.jpg?raw=true","date":"2020-05-25"}},"previous":{"fields":{"slug":"/kubernetes/drone/"},"frontmatter":{"title":"Drone CI"}},"next":{"fields":{"slug":"/kubernetes/component/"},"frontmatter":{"title":"Component"}}},"pageContext":{"id":"41ed7fb8-dd4d-5965-ab4f-5b0a1c059231","previousPostID":"5dd1589e-3eef-5561-accf-bbe44538f5d1","nextPostID":"57e89794-5c2c-5a1e-b3ba-4b67824db3f2"}},
    "staticQueryHashes": ["3000541721"]}