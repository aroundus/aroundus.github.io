{
    "componentChunkName": "component---src-components-template-post-template-tsx",
    "path": "/post/kubernetes/kafka/",
    "result": {"data":{"site":{"siteMetadata":{"title":"AROUNDUS"}},"markdownRemark":{"id":"ab9ade26-27a9-56bb-b934-e9f48bdc0237","fields":{"slug":"/post/kubernetes/kafka/"},"html":"<blockquote>\n<p>대규모 메시지 플랫폼 Apache Kafka(카프카)를 Amazon EKS 서비스에 배포해 봅시다. 본 문서는 카프카에 대한 기본적인 내용은 다루지 않습니다. 🙏</p>\n</blockquote>\n<h2 id=\"목차\" style=\"position:relative;\">목차<a href=\"#%EB%AA%A9%EC%B0%A8\" aria-label=\"목차 permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<ol>\n<li><a href=\"#ZooKeeper\">ZooKeeper</a></li>\n<li><a href=\"#Kafka\">Kafka</a></li>\n<li><a href=\"#Kafka-Manager\">Kafka Manager</a></li>\n<li><a href=\"#Topic\">Topic</a></li>\n</ol>\n<h2 id=\"ZooKeeper\" style=\"position:relative;\">ZooKeeper<a href=\"#ZooKeeper\" aria-label=\"ZooKeeper permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p>Apache <strong>ZooKeeper</strong>(주키퍼)는 분산 애플리케이션을 위한 분산 오픈 소스 코디네이션 서비스입니다. 분산 시스템을 다루기 위해 사용하는 중요한 서비스 중 하나로 분산 시스템이 안전하게 작동할 수 있는 API를 제공합니다.</p>\n<blockquote>\n<p>주키퍼를 개발할 때 아파치 개발자들은 마치 자신들이 동물원에 사는 것처럼 보인다고 말했습니다. 당시 Apache Pig(피그)를 비롯하여 동물의 이름을 프로젝트에 사용하고 있었기 때문입니다. 이 발언에 착안하여 분산 시스템(Kafka)은 다양한 동물들이 살고 있는 동물원으로, 동물원을 제대로 운영하려면 이를 통제하는 사육사(ZooKeeper)가 필요하다는 생각을 하게 되었습니다.</p>\n</blockquote>\n<p>주키퍼는 메타 정보를 저장합니다. <em>- 실제 메시지는 카프카가 저장합니다. -</em> 현재 카프카 서버가 몇 대 작동 중인지, 카프카 컨슈머가 어디까지 메시지를 읽었는지 등의 스냅샷 정보를 저장합니다.</p>\n<p>필자는 <strong>Helm</strong>(헬름)에서 제공하는 차트를 사용하였습니다. 헬름 차트에 대한 자세한 정보는 헬름 공식 문서의 <a href=\"https://github.com/helm/charts/tree/master/incubator/zookeeper\">zookeeper</a> 내용을 참조하세요.</p>\n<blockquote>\n<p>헬름은 카프카를 설치할 때 주키퍼를 자동으로 설치하면서 이름을 <code>zookeeper</code>가 아닌 <code>kafka-zookeeper</code>로 정의합니다. 필자는 헬름 차트를 인용하기 때문에 헬름에서 정의한 이름을 그대로 사용하였습니다.</p>\n</blockquote>\n<h3 id=\"PodDisruptionBudget\" style=\"position:relative;\">PodDisruptionBudget<a href=\"#PodDisruptionBudget\" aria-label=\"PodDisruptionBudget permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h3>\n<p><code>PodDisruptionBudget</code>(파드 디스럽션 버짓) 오브젝트는 파드의 재시작 등에 의한 자발적 중단으로 일시에 중지되는 <em>- 복제된 -</em> 주키퍼 파드의 수를 제한합니다.</p>\n<p><strong>poddisruptionbudget.yaml</strong></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"69985860042463010000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: policy/v1beta1\nkind: PodDisruptionBudget\nmetadata:\n  name: kafka-zookeeper\n  namespace: <your-namespace>\n  labels:\n    app: zookeeper\n    chart: zookeeper-2.1.0\n    release: kafka\n    heritage: Helm\n    component: server\nspec:\n  selector:\n    matchLabels:\n      app: zookeeper\n      release: kafka\n      component: server\n  maxUnavailable: 1`, `69985860042463010000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> policy/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PodDisruptionBudget\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>zookeeper\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n    <span class=\"token key atrule\">chart</span><span class=\"token punctuation\">:</span> zookeeper<span class=\"token punctuation\">-</span>2.1.0\n    <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">heritage</span><span class=\"token punctuation\">:</span> Helm\n    <span class=\"token key atrule\">component</span><span class=\"token punctuation\">:</span> server\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n      <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n      <span class=\"token key atrule\">component</span><span class=\"token punctuation\">:</span> server\n  <span class=\"token key atrule\">maxUnavailable</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li><code>selector</code>: 적용할 파드의 매칭 정보</li>\n<li><code>maxUnavailable</code>: 비정상 상태를 허용하는 파드의 수</li>\n</ul>\n<h3 id=\"ConfigMap\" style=\"position:relative;\">ConfigMap<a href=\"#ConfigMap\" aria-label=\"ConfigMap permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h3>\n<p><code>ConfigMap</code>(컨피그맵) 오브젝트는 주키퍼 실행에 필요한 설정 정보를 미리 정의해 쿠버네티스에 저장소 형태로 저장합니다.</p>\n<p><strong>config-script.yaml</strong></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"83920119781675680000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kafka-zookeeper\n  namespace: <your-namespace>\n  labels:\n    app: zookeeper\n    chart: zookeeper-2.1.0\n    release: kafka\n    heritage: Helm\n    component: server\ndata:\n  ok: |\n    #!/bin/sh\n    echo ruok | nc 127.0.0.1 \\${1:-2181}\n\n  ready: |\n    #!/bin/sh\n    echo ruok | nc 127.0.0.1 \\${1:-2181}\n\n  run: |\n    #!/bin/bash\n\n    set -a\n    ROOT=\\$(echo /apache-zookeeper-*)\n\n    ZK_USER=\\${ZK_USER:-&quot;zookeeper&quot;}\n    ZK_LOG_LEVEL=\\${ZK_LOG_LEVEL:-&quot;INFO&quot;}\n    ZK_DATA_DIR=\\${ZK_DATA_DIR:-&quot;/data&quot;}\n    ZK_DATA_LOG_DIR=\\${ZK_DATA_LOG_DIR:-&quot;/data/log&quot;}\n    ZK_CONF_DIR=\\${ZK_CONF_DIR:-&quot;/conf&quot;}\n    ZK_CLIENT_PORT=\\${ZK_CLIENT_PORT:-2181}\n    ZK_SERVER_PORT=\\${ZK_SERVER_PORT:-2888}\n    ZK_ELECTION_PORT=\\${ZK_ELECTION_PORT:-3888}\n    ZK_TICK_TIME=\\${ZK_TICK_TIME:-2000}\n    ZK_INIT_LIMIT=\\${ZK_INIT_LIMIT:-10}\n    ZK_SYNC_LIMIT=\\${ZK_SYNC_LIMIT:-5}\n    ZK_HEAP_SIZE=\\${ZK_HEAP_SIZE:-2G}\n    ZK_MAX_CLIENT_CNXNS=\\${ZK_MAX_CLIENT_CNXNS:-60}\n    ZK_MIN_SESSION_TIMEOUT=\\${ZK_MIN_SESSION_TIMEOUT:- \\$((ZK_TICK_TIME*2))}\n    ZK_MAX_SESSION_TIMEOUT=\\${ZK_MAX_SESSION_TIMEOUT:- \\$((ZK_TICK_TIME*20))}\n    ZK_SNAP_RETAIN_COUNT=\\${ZK_SNAP_RETAIN_COUNT:-3}\n    ZK_PURGE_INTERVAL=\\${ZK_PURGE_INTERVAL:-0}\n    ID_FILE=&quot;\\$ZK_DATA_DIR/myid&quot;\n    ZK_CONFIG_FILE=&quot;\\$ZK_CONF_DIR/zoo.cfg&quot;\n    LOG4J_PROPERTIES=&quot;\\$ZK_CONF_DIR/log4j.properties&quot;\n    HOST=\\$(hostname)\n    DOMAIN=\\`hostname -d\\`\n    ZOOCFG=zoo.cfg\n    ZOOCFGDIR=\\$ZK_CONF_DIR\n    JVMFLAGS=&quot;-Xmx\\$ZK_HEAP_SIZE -Xms\\$ZK_HEAP_SIZE&quot;\n\n    APPJAR=\\$(echo \\$ROOT/*jar)\n    CLASSPATH=&quot;\\${ROOT}/lib/*:\\${APPJAR}:\\${ZK_CONF_DIR}:&quot;\n\n    if [[ \\$HOST =~ (.*)-([0-9]+)]]; then\n        NAME=\\${BASH_REMATCH[1]}\n        ORD=\\${BASH_REMATCH[2]}\n        MY_ID=\\$((ORD+1))\n    else\n        echo &quot;Failed to extract ordinal from hostname \\$HOST&quot;\n        exit 1\n    fi\n\n    mkdir -p \\$ZK_DATA_DIR\n    mkdir -p \\$ZK_DATA_LOG_DIR\n    echo \\$MY_ID >> \\$ID_FILE\n\n    echo &quot;clientPort=\\$ZK_CLIENT_PORT&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;dataDir=\\$ZK_DATA_DIR&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;dataLogDir=\\$ZK_DATA_LOG_DIR&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;tickTime=\\$ZK_TICK_TIME&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;initLimit=\\$ZK_INIT_LIMIT&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;syncLimit=\\$ZK_SYNC_LIMIT&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;maxClientCnxns=\\$ZK_MAX_CLIENT_CNXNS&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;minSessionTimeout=\\$ZK_MIN_SESSION_TIMEOUT&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;maxSessionTimeout=\\$ZK_MAX_SESSION_TIMEOUT&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;autopurge.snapRetainCount=\\$ZK_SNAP_RETAIN_COUNT&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;autopurge.purgeInterval=\\$ZK_PURGE_INTERVAL&quot; >> \\$ZK_CONFIG_FILE\n    echo &quot;4lw.commands.whitelist=*&quot; >> \\$ZK_CONFIG_FILE\n\n    for (( i=1; i<=\\$ZK_REPLICAS; i++ ))\n    do\n        echo &quot;server.\\$i=\\$NAME-\\$((i-1)).\\$DOMAIN:\\$ZK_SERVER_PORT:\\$ZK_ELECTION_PORT&quot; >> \\$ZK_CONFIG_FILE\n    done\n\n    rm -f \\$LOG4J_PROPERTIES\n\n    echo &quot;zookeeper.root.logger=\\$ZK_LOG_LEVEL, CONSOLE&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.console.threshold=\\$ZK_LOG_LEVEL&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.log.threshold=\\$ZK_LOG_LEVEL&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.log.dir=\\$ZK_DATA_LOG_DIR&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.log.file=zookeeper.log&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.log.maxfilesize=256MB&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.log.maxbackupindex=10&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.tracelog.dir=\\$ZK_DATA_LOG_DIR&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;zookeeper.tracelog.file=zookeeper_trace.log&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;log4j.rootLogger=\\\\${zookeeper.root.logger}&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;log4j.appender.CONSOLE.Threshold=\\\\${zookeeper.console.threshold}&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout&quot; >> \\$LOG4J_PROPERTIES\n    echo &quot;log4j.appender.CONSOLE.layout.ConversionPattern=%d{ISO8601} [myid:%X{myid}] - %-5p [%t:%C{1}@%L] - %m%n&quot; >> \\$LOG4J_PROPERTIES\n\n    if [ -n &quot;\\$JMXDISABLE&quot; ]\n    then\n        MAIN=org.apache.zookeeper.server.quorum.QuorumPeerMain\n    else\n        MAIN=&quot;-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=\\$JMXPORT -Dcom.sun.management.jmxremote.authenticate=\\$JMXAUTH -Dcom.sun.management.jmxremote.ssl=\\$JMXSSL -Dzookeeper.jmx.log4j.disable=\\$JMXLOG4J org.apache.zookeeper.server.quorum.QuorumPeerMain&quot;\n    fi\n\n    set -x\n    exec java -cp &quot;\\$CLASSPATH&quot; \\$JVMFLAGS \\$MAIN \\$ZK_CONFIG_FILE`, `83920119781675680000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>zookeeper\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n    <span class=\"token key atrule\">chart</span><span class=\"token punctuation\">:</span> zookeeper<span class=\"token punctuation\">-</span>2.1.0\n    <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">heritage</span><span class=\"token punctuation\">:</span> Helm\n    <span class=\"token key atrule\">component</span><span class=\"token punctuation\">:</span> server\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ok</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    #!/bin/sh\n    echo ruok | nc 127.0.0.1 ${1:-2181}</span>\n\n  <span class=\"token key atrule\">ready</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    #!/bin/sh\n    echo ruok | nc 127.0.0.1 ${1:-2181}</span>\n\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n    #!/bin/bash</span>\n\n    set <span class=\"token punctuation\">-</span>a\n    ROOT=$(echo /apache<span class=\"token punctuation\">-</span>zookeeper<span class=\"token punctuation\">-</span><span class=\"token important\">*)</span>\n\n    ZK_USER=$<span class=\"token punctuation\">{</span>ZK_USER<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span><span class=\"token string\">\"zookeeper\"</span><span class=\"token punctuation\">}</span>\n    ZK_LOG_LEVEL=$<span class=\"token punctuation\">{</span>ZK_LOG_LEVEL<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span><span class=\"token string\">\"INFO\"</span><span class=\"token punctuation\">}</span>\n    ZK_DATA_DIR=$<span class=\"token punctuation\">{</span>ZK_DATA_DIR<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span><span class=\"token string\">\"/data\"</span><span class=\"token punctuation\">}</span>\n    ZK_DATA_LOG_DIR=$<span class=\"token punctuation\">{</span>ZK_DATA_LOG_DIR<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span><span class=\"token string\">\"/data/log\"</span><span class=\"token punctuation\">}</span>\n    ZK_CONF_DIR=$<span class=\"token punctuation\">{</span>ZK_CONF_DIR<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span><span class=\"token string\">\"/conf\"</span><span class=\"token punctuation\">}</span>\n    ZK_CLIENT_PORT=$<span class=\"token punctuation\">{</span>ZK_CLIENT_PORT<span class=\"token punctuation\">:</span><span class=\"token number\">-2181</span><span class=\"token punctuation\">}</span>\n    ZK_SERVER_PORT=$<span class=\"token punctuation\">{</span>ZK_SERVER_PORT<span class=\"token punctuation\">:</span><span class=\"token number\">-2888</span><span class=\"token punctuation\">}</span>\n    ZK_ELECTION_PORT=$<span class=\"token punctuation\">{</span>ZK_ELECTION_PORT<span class=\"token punctuation\">:</span><span class=\"token number\">-3888</span><span class=\"token punctuation\">}</span>\n    ZK_TICK_TIME=$<span class=\"token punctuation\">{</span>ZK_TICK_TIME<span class=\"token punctuation\">:</span><span class=\"token number\">-2000</span><span class=\"token punctuation\">}</span>\n    ZK_INIT_LIMIT=$<span class=\"token punctuation\">{</span>ZK_INIT_LIMIT<span class=\"token punctuation\">:</span><span class=\"token number\">-10</span><span class=\"token punctuation\">}</span>\n    ZK_SYNC_LIMIT=$<span class=\"token punctuation\">{</span>ZK_SYNC_LIMIT<span class=\"token punctuation\">:</span><span class=\"token number\">-5</span><span class=\"token punctuation\">}</span>\n    ZK_HEAP_SIZE=$<span class=\"token punctuation\">{</span>ZK_HEAP_SIZE<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span>2G<span class=\"token punctuation\">}</span>\n    ZK_MAX_CLIENT_CNXNS=$<span class=\"token punctuation\">{</span>ZK_MAX_CLIENT_CNXNS<span class=\"token punctuation\">:</span><span class=\"token number\">-60</span><span class=\"token punctuation\">}</span>\n    ZK_MIN_SESSION_TIMEOUT=$<span class=\"token punctuation\">{</span>ZK_MIN_SESSION_TIMEOUT<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span> $((ZK_TICK_TIME<span class=\"token important\">*2))</span><span class=\"token punctuation\">}</span>\n    ZK_MAX_SESSION_TIMEOUT=$<span class=\"token punctuation\">{</span>ZK_MAX_SESSION_TIMEOUT<span class=\"token punctuation\">:</span><span class=\"token punctuation\">-</span> $((ZK_TICK_TIME<span class=\"token important\">*20))</span><span class=\"token punctuation\">}</span>\n    ZK_SNAP_RETAIN_COUNT=$<span class=\"token punctuation\">{</span>ZK_SNAP_RETAIN_COUNT<span class=\"token punctuation\">:</span><span class=\"token number\">-3</span><span class=\"token punctuation\">}</span>\n    ZK_PURGE_INTERVAL=$<span class=\"token punctuation\">{</span>ZK_PURGE_INTERVAL<span class=\"token punctuation\">:</span><span class=\"token number\">-0</span><span class=\"token punctuation\">}</span>\n    ID_FILE=\"$ZK_DATA_DIR/myid\"\n    ZK_CONFIG_FILE=\"$ZK_CONF_DIR/zoo.cfg\"\n    LOG4J_PROPERTIES=\"$ZK_CONF_DIR/log4j.properties\"\n    HOST=$(hostname)\n    DOMAIN=`hostname <span class=\"token punctuation\">-</span>d`\n    ZOOCFG=zoo.cfg\n    ZOOCFGDIR=$ZK_CONF_DIR\n    JVMFLAGS=\"<span class=\"token punctuation\">-</span>Xmx$ZK_HEAP_SIZE <span class=\"token punctuation\">-</span>Xms$ZK_HEAP_SIZE\"\n\n    APPJAR=$(echo $ROOT/<span class=\"token important\">*jar)</span>\n    CLASSPATH=\"$<span class=\"token punctuation\">{</span>ROOT<span class=\"token punctuation\">}</span>/lib/<span class=\"token important\">*:$</span><span class=\"token punctuation\">{</span>APPJAR<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span>ZK_CONF_DIR<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>\"\n\n    if <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> $HOST =~ (.<span class=\"token important\">*)-(</span><span class=\"token punctuation\">[</span>0<span class=\"token punctuation\">-</span><span class=\"token number\">9</span><span class=\"token punctuation\">]</span>+)<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>; then\n        NAME=$<span class=\"token punctuation\">{</span>BASH_REMATCH<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n        ORD=$<span class=\"token punctuation\">{</span>BASH_REMATCH<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n        MY_ID=$((ORD+1))\n    else\n        echo \"Failed to extract ordinal from hostname $HOST\"\n        exit 1\n    fi\n\n    mkdir <span class=\"token punctuation\">-</span>p $ZK_DATA_DIR\n    mkdir <span class=\"token punctuation\">-</span>p $ZK_DATA_LOG_DIR\n    echo $MY_ID <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ID_FILE\n\n    echo \"clientPort=$ZK_CLIENT_PORT\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"dataDir=$ZK_DATA_DIR\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"dataLogDir=$ZK_DATA_LOG_DIR\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"tickTime=$ZK_TICK_TIME\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"initLimit=$ZK_INIT_LIMIT\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"syncLimit=$ZK_SYNC_LIMIT\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"maxClientCnxns=$ZK_MAX_CLIENT_CNXNS\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"minSessionTimeout=$ZK_MIN_SESSION_TIMEOUT\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"maxSessionTimeout=$ZK_MAX_SESSION_TIMEOUT\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"autopurge.snapRetainCount=$ZK_SNAP_RETAIN_COUNT\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"autopurge.purgeInterval=$ZK_PURGE_INTERVAL\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    echo \"4lw.commands.whitelist=<span class=\"token important\">*\"</span> <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n\n    for (( i=1; i&lt;=$ZK_REPLICAS; i++ ))\n    do\n        echo \"server.$i=$NAME<span class=\"token punctuation\">-</span>$((i<span class=\"token punctuation\">-</span>1)).$DOMAIN<span class=\"token punctuation\">:</span>$ZK_SERVER_PORT<span class=\"token punctuation\">:</span>$ZK_ELECTION_PORT\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $ZK_CONFIG_FILE\n    done\n\n    rm <span class=\"token punctuation\">-</span>f $LOG4J_PROPERTIES\n\n    echo \"zookeeper.root.logger=$ZK_LOG_LEVEL<span class=\"token punctuation\">,</span> CONSOLE\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.console.threshold=$ZK_LOG_LEVEL\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.log.threshold=$ZK_LOG_LEVEL\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.log.dir=$ZK_DATA_LOG_DIR\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.log.file=zookeeper.log\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.log.maxfilesize=256MB\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.log.maxbackupindex=10\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.tracelog.dir=$ZK_DATA_LOG_DIR\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"zookeeper.tracelog.file=zookeeper_trace.log\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"log4j.rootLogger=\\$<span class=\"token punctuation\">{</span>zookeeper.root.logger<span class=\"token punctuation\">}</span>\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"log4j.appender.CONSOLE.Threshold=\\$<span class=\"token punctuation\">{</span>zookeeper.console.threshold<span class=\"token punctuation\">}</span>\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n    echo \"log4j.appender.CONSOLE.layout.ConversionPattern=%d<span class=\"token punctuation\">{</span>ISO8601<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span>myid<span class=\"token punctuation\">:</span>%X<span class=\"token punctuation\">{</span>myid<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">-</span> %<span class=\"token punctuation\">-</span>5p <span class=\"token punctuation\">[</span>%t<span class=\"token punctuation\">:</span>%C<span class=\"token punctuation\">{</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span>@%L<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">-</span> %m%n\" <span class=\"token punctuation\">></span><span class=\"token punctuation\">></span> $LOG4J_PROPERTIES\n\n    if <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">-</span>n \"$JMXDISABLE\" <span class=\"token punctuation\">]</span>\n    then\n        MAIN=org.apache.zookeeper.server.quorum.QuorumPeerMain\n    else\n        MAIN=\"<span class=\"token punctuation\">-</span>Dcom.sun.management.jmxremote <span class=\"token punctuation\">-</span>Dcom.sun.management.jmxremote.port=$JMXPORT <span class=\"token punctuation\">-</span>Dcom.sun.management.jmxremote.authenticate=$JMXAUTH <span class=\"token punctuation\">-</span>Dcom.sun.management.jmxremote.ssl=$JMXSSL <span class=\"token punctuation\">-</span>Dzookeeper.jmx.log4j.disable=$JMXLOG4J org.apache.zookeeper.server.quorum.QuorumPeerMain\"\n    fi\n\n    set <span class=\"token punctuation\">-</span>x\n    exec java <span class=\"token punctuation\">-</span>cp \"$CLASSPATH\" $JVMFLAGS $MAIN $ZK_CONFIG_FILE</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"Service\" style=\"position:relative;\">Service<a href=\"#Service\" aria-label=\"Service permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p><strong>service.yaml</strong></p>\n<p>클러스터 IP를 지정하면 쿠버네티스 클러스터 내에서 접근 가능한 내부 IP를 할당합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"94283337361725310000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: v1\nkind: Service\nmetadata:\n  name: kafka-zookeeper\n  namespace: <your-namespace>\n  labels:\n    app: zookeeper\n    chart: zookeeper-2.1.0\n    release: kafka\n    heritage: Helm\nspec:\n  type: ClusterIP\n  ports:\n    - name: client\n      port: 2181\n      protocol: TCP\n      targetPort: client\n  selector:\n    app: zookeeper\n    release: kafka`, `94283337361725310000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>zookeeper\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n    <span class=\"token key atrule\">chart</span><span class=\"token punctuation\">:</span> zookeeper<span class=\"token punctuation\">-</span>2.1.0\n    <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">heritage</span><span class=\"token punctuation\">:</span> Helm\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> client\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2181</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> client\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n    <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>service-headless.yaml</strong></p>\n<p><code>headless</code> 오브젝트는 단일 서비스 IP를 필요로 하지 않아 <code>None</code> 클러스터 IP를 명시적으로 지정하는 서비스를 의미합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"37520137779442280000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: v1\nkind: Service\nmetadata:\n  name: kafka-zookeeper-headless\n  namespace: <your-namespace>\n  labels:\n    app: zookeeper\n    chart: zookeeper-2.1.0\n    release: kafka\n    heritage: Helm\nspec:\n  clusterIP: None\n  ports:\n    - name: client\n      port: 2181\n      targetPort: client\n      protocol: TCP\n    - name: election\n      port: 3888\n      targetPort: election\n      protocol: TCP\n    - name: server\n      port: 2888\n      targetPort: server\n      protocol: TCP\n  selector:\n    app: zookeeper\n    release: kafka`, `37520137779442280000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>zookeeper<span class=\"token punctuation\">-</span>headless\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n    <span class=\"token key atrule\">chart</span><span class=\"token punctuation\">:</span> zookeeper<span class=\"token punctuation\">-</span>2.1.0\n    <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">heritage</span><span class=\"token punctuation\">:</span> Helm\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">clusterIP</span><span class=\"token punctuation\">:</span> None\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> client\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2181</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> client\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> election\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3888</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> election\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> server\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2888</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> server\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n    <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id=\"StatefulSet\" style=\"position:relative;\">StatefulSet<a href=\"#StatefulSet\" aria-label=\"StatefulSet permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p><strong>StatefulSet</strong>(스테이트풀셋) 오브젝트는 상태 유지가 필요한(stateful) 애플리케이션에 사용합니다. 파드를 수시로 재시작해도 볼륨을 삭제하지 않아 내용이 유실되지 않습니다.</p>\n<p><strong>statefulset.yaml</strong></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"36733076691165344000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: kafka-zookeeper\n  namespace: <your-namespace>\n  labels:\n    app: zookeeper\n    chart: zookeeper-2.1.0\n    release: kafka\n    heritage: Helm\n    component: server\nspec:\n  serviceName: kafka-zookeeper-headless\n  replicas: 3\n  selector:\n    matchLabels:\n      app: zookeeper\n      release: kafka\n      component: server\n  updateStrategy:\n    type: RollingUpdate\n  template:\n    metadata:\n      labels:\n        app: zookeeper\n        release: kafka\n        component: server\n    spec:\n      terminationGracePeriodSeconds: 1800\n      securityContext:\n        fsGroup: 1000\n        runAsUser: 1000\n      containers:\n        - name: zookeeper\n          image: &quot;zookeeper:3.5.5&quot;\n          imagePullPolicy: IfNotPresent\n          resources:\n            requests:\n              cpu: 50m\n              memory: 128Mi\n            limits:\n              cpu: 200m\n              memory: 128Mi\n          command:\n            - &quot;/bin/bash&quot;\n            - &quot;-xec&quot;\n            - &quot;/config-scripts/run&quot;\n          ports:\n            - name: client\n              containerPort: 2181\n              protocol: TCP\n            - name: election\n              containerPort: 3888\n              protocol: TCP\n            - name: server\n              containerPort: 2888\n              protocol: TCP\n          livenessProbe:\n            exec:\n              command:\n                - sh\n                - /config-scripts/ok\n            initialDelaySeconds: 20\n            periodSeconds: 30\n            timeoutSeconds: 5\n            failureThreshold: 2\n            successThreshold: 1\n          readinessProbe:\n            exec:\n              command:\n                - sh\n                - /config-scripts/ready\n            initialDelaySeconds: 20\n            periodSeconds: 30\n            timeoutSeconds: 5\n            failureThreshold: 2\n            successThreshold: 1\n          env:\n            - name: ZK_REPLICAS\n              value: &quot;3&quot;\n            - name: JMXAUTH\n              value: &quot;false&quot;\n            - name: JMXDISABLE\n              value: &quot;false&quot;\n            - name: JMXPORT\n              value: &quot;1099&quot;\n            - name: JMXSSL\n              value: &quot;false&quot;\n            - name: ZK_HEAP_SIZE\n              value: &quot;96M&quot;\n            - name: ZK_SYNC_LIMIT\n              value: &quot;10&quot;\n            - name: ZK_TICK_TIME\n              value: &quot;2000&quot;\n            - name: ZOO_AUTOPURGE_PURGEINTERVAL\n              value: &quot;1&quot;\n            - name: ZOO_AUTOPURGE_SNAPRETAINCOUNT\n              value: &quot;3&quot;\n            - name: ZOO_INIT_LIMIT\n              value: &quot;5&quot;\n            - name: ZOO_MAX_CLIENT_CNXNS\n              value: &quot;60&quot;\n            - name: ZOO_PORT\n              value: &quot;2181&quot;\n            - name: ZOO_STANDALONE_ENABLED\n              value: &quot;false&quot;\n            - name: ZOO_TICK_TIME\n              value: &quot;2000&quot;\n          volumeMounts:\n            - name: data\n              mountPath: /data\n            - name: config\n              mountPath: /config-scripts\n      volumes:\n        - name: config\n          configMap:\n            name: kafka-zookeeper\n            defaultMode: 0555\n        - name: data\n          emptyDir: {}\n  volumeClaimTemplates:\n    - metadata:\n        name: data\n      spec:\n        accessModes: [&quot;ReadWriteOnce&quot;]\n        storageClassName: &quot;ebs-default&quot;\n        resources:\n          requests:\n            storage: 10Gi`, `36733076691165344000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StatefulSet\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>zookeeper\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n    <span class=\"token key atrule\">chart</span><span class=\"token punctuation\">:</span> zookeeper<span class=\"token punctuation\">-</span>2.1.0\n    <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">heritage</span><span class=\"token punctuation\">:</span> Helm\n    <span class=\"token key atrule\">component</span><span class=\"token punctuation\">:</span> server\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>zookeeper<span class=\"token punctuation\">-</span>headless\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n      <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n      <span class=\"token key atrule\">component</span><span class=\"token punctuation\">:</span> server\n  <span class=\"token key atrule\">updateStrategy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> RollingUpdate\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> zookeeper\n        <span class=\"token key atrule\">release</span><span class=\"token punctuation\">:</span> kafka\n        <span class=\"token key atrule\">component</span><span class=\"token punctuation\">:</span> server\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">terminationGracePeriodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1800</span>\n      <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">fsGroup</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n        <span class=\"token key atrule\">runAsUser</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> zookeeper\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"zookeeper:3.5.5\"</span>\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 200m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 128Mi\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"/bin/bash\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"-xec\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"/config-scripts/run\"</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> client\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2181</span>\n              <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> election\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3888</span>\n              <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> server\n              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2888</span>\n              <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n          <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> sh\n                <span class=\"token punctuation\">-</span> /config<span class=\"token punctuation\">-</span>scripts/ok\n            <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n            <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n            <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n            <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n            <span class=\"token key atrule\">successThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> sh\n                <span class=\"token punctuation\">-</span> /config<span class=\"token punctuation\">-</span>scripts/ready\n            <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n            <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n            <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n            <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n            <span class=\"token key atrule\">successThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZK_REPLICAS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> JMXAUTH\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> JMXDISABLE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> JMXPORT\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1099\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> JMXSSL\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZK_HEAP_SIZE\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"96M\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZK_SYNC_LIMIT\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"10\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZK_TICK_TIME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2000\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZOO_AUTOPURGE_PURGEINTERVAL\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZOO_AUTOPURGE_SNAPRETAINCOUNT\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZOO_INIT_LIMIT\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZOO_MAX_CLIENT_CNXNS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"60\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZOO_PORT\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2181\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZOO_STANDALONE_ENABLED\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZOO_TICK_TIME\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2000\"</span>\n          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /data\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> config\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /config<span class=\"token punctuation\">-</span>scripts\n      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> config\n          <span class=\"token key atrule\">configMap</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>zookeeper\n            <span class=\"token key atrule\">defaultMode</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0555</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n          <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token key atrule\">volumeClaimTemplates</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\n      <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"ReadWriteOnce\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ebs-default\"</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Gi</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code>replicas</code> 필드 값에 따라 노드(서버)를 총 3개 생성하는데 이렇게 생성한 각각의 주키퍼 노드를 ZNode(지노드)라고 합니다. ZNode 중 1개는 Leader(리더) 노드, 나머지는 리더의 명령을 따르는 Follower(팔로워) 노드로 나뉩니다. 리더는 팔로워 노드가 중단됐을 때 자동 복구를 수행하는 중심 노드로 서버 구동과 동시에 선출됩니다.</p>\n<blockquote>\n<p>주키퍼 노드는 다음과 같은 알고리즘에 의하여 반드시 <strong>홀수</strong>로 생성해야 합니다.</p>\n<ul>\n<li>과반수 이상의 노드가 다운됐을 때 서비스를 중지합니다. 예를 들어, 3대 중 2대가 다운됐을 때 과반수 이상에 성립하여 서비스를 중지합니다.</li>\n<li>리더 노드가 트랜잭션 생성 후 팔로워 노드에 전파할 때 과반수 이상이 트랜잭션에 성공해야 클라이언트에 성공 결과를 반환합니다.</li>\n</ul>\n</blockquote>\n<p><code>PersistentVolumeClaim</code> 오브젝트로 정의하면 파드 이름을 불규칙적으로 지정하지만, <code>StatefulSet</code> 오브젝트는 <code>PersistentVolume</code> 리소스를 생성할 때 파드 이름을 규칙적으로 지정합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">zookeeper-0\nzookeeper-1\nzookeeper-2</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>파드를 생성할 때 동시에 모든 파드를 생성하지 않고 0부터 오름차순으로 하나씩 생성할 수 있는 순차 기동이 가능합니다. 반대로 삭제할 때는 내림차순으로 하나씩 삭제합니다.</p>\n<blockquote>\n<p>순차 기동에 의해 데이터를 유지하는 자세한 정보는 조대협의 <a href=\"https://bcho.tistory.com/1306\">StatefulSet</a> 내용을 참조하세요. 볼륨은 한 번 생성하면 삭제할 수 없기 때문에 <code>replicas</code> 필드 값을 늘릴 수는 있어도 줄일 수는 없습니다. 유의하세요.</p>\n</blockquote>\n<p><strong>kafka-zookeeper.yaml</strong></p>\n<p>배포해야 할 파일이 많은 경우 서비스를 배포하거나 추후 서비스를 삭제할 때 실수할 수 있기 때문에 하나의 파일에 모아서 <code>---</code> 구분선을 주는 방식으로 작업하세요.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"4925873251424928000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<insert poddisruptionbudget.yaml>\n---\n<insert config-script.yaml>\n---\n<insert service.yaml>\n---\n<insert service-headless.yaml>\n---\n<insert statefulset.yaml>`, `4925873251424928000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\">&lt;insert poddisruptionbudget.yaml<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">---</span>\n&lt;insert config<span class=\"token punctuation\">-</span>script.yaml<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">---</span>\n&lt;insert service.yaml<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">---</span>\n&lt;insert service<span class=\"token punctuation\">-</span>headless.yaml<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">---</span>\n&lt;insert statefulset.yaml<span class=\"token punctuation\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"72921668375877410000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kubectl apply -f kafka-zookeeper.yaml`, `72921668375877410000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kubectl apply -f kafka-zookeeper.yaml</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 795px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6736f173051e6f80cea2c1c0a65feafe/396d0/apply-kafka-zookeeper.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.583333333333332%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/6736f173051e6f80cea2c1c0a65feafe/396d0/apply-kafka-zookeeper.jpg\"\n        srcset=\"/static/6736f173051e6f80cea2c1c0a65feafe/a3e66/apply-kafka-zookeeper.jpg 480w,\n/static/6736f173051e6f80cea2c1c0a65feafe/396d0/apply-kafka-zookeeper.jpg 795w\"\n        sizes=\"(max-width: 795px) 100vw, 795px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"Kafka\" style=\"position:relative;\">Kafka<a href=\"#Kafka\" aria-label=\"Kafka permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p>필자는 <strong>Helm</strong>(헬름)에서 제공하는 차트를 사용하였습니다. 헬름 차트에 대한 자세한 정보는 헬름 공식 문서의 <a href=\"https://github.com/helm/charts/tree/master/incubator/kafka\">Kafka</a> 내용을 참조하세요.</p>\n<h3 id=\"Service-1\" style=\"position:relative;\">Service<a href=\"#Service-1\" aria-label=\"Service 1 permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h3>\n<p><strong>service-brokers.yaml</strong></p>\n<p><code>kafka-broker</code>(카프카 브로커)는 카프카 서버를 의미합니다. 카프카 브로커는 기본 9092 포트를 사용합니다.</p>\n<p>Kafka <strong>Cluster</strong>(클러스터)는 카프카를 실행하는 하나 이상의 서버(브로커)로 구성됩니다. 클러스터의 브로커 관리는 주키퍼가 수행합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1920px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/34a4caab6cfa342d39f29de18c804604/9bfa6/architecture-for-apache-kafka.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.958333333333336%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/34a4caab6cfa342d39f29de18c804604/aaf92/architecture-for-apache-kafka.jpg\"\n        srcset=\"/static/34a4caab6cfa342d39f29de18c804604/a3e66/architecture-for-apache-kafka.jpg 480w,\n/static/34a4caab6cfa342d39f29de18c804604/fb816/architecture-for-apache-kafka.jpg 960w,\n/static/34a4caab6cfa342d39f29de18c804604/aaf92/architecture-for-apache-kafka.jpg 1920w,\n/static/34a4caab6cfa342d39f29de18c804604/9bfa6/architecture-for-apache-kafka.jpg 1999w\"\n        sizes=\"(max-width: 1920px) 100vw, 1920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"6051596687106509000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: v1\nkind: Service\nmetadata:\n  name: kafka\n  namespace: <your-namespace>\n  labels:\n    helm.sh/chart: kafka-0.20.5\n    app.kubernetes.io/managed-by: Helm\n    app.kubernetes.io/component: kafka-broker\n    app.kubernetes.io/name: kafka\n    app.kubernetes.io/instance: kafka\nspec:\n  ports:\n    - name: broker\n      port: 9092\n      targetPort: kafka\n  selector:\n    app.kubernetes.io/component: kafka-broker\n    app.kubernetes.io/name: kafka\n    app.kubernetes.io/instance: kafka`, `6051596687106509000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">helm.sh/chart</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>0.20.5\n    <span class=\"token key atrule\">app.kubernetes.io/managed-by</span><span class=\"token punctuation\">:</span> Helm\n    <span class=\"token key atrule\">app.kubernetes.io/component</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n    <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> kafka\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> broker\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9092</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> kafka\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app.kubernetes.io/component</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n    <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> kafka</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>service-headless.yaml</strong></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"42353199130734230000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: v1\nkind: Service\nmetadata:\n  name: kafka-headless\n  namespace: <your-namespace>\n  labels:\n    helm.sh/chart: kafka-0.20.5\n    app.kubernetes.io/managed-by: Helm\n    app.kubernetes.io/component: kafka-broker\n    app.kubernetes.io/name: kafka\n    app.kubernetes.io/instance: kafka\n  annotations:\n    service.alpha.kubernetes.io/tolerate-unready-endpoints: &quot;true&quot;\nspec:\n  ports:\n    - name: broker\n      port: 9092\n  clusterIP: None\n  selector:\n    app.kubernetes.io/component: kafka-broker\n    app.kubernetes.io/name: kafka\n    app.kubernetes.io/instance: kafka`, `42353199130734230000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>headless\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">helm.sh/chart</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>0.20.5\n    <span class=\"token key atrule\">app.kubernetes.io/managed-by</span><span class=\"token punctuation\">:</span> Helm\n    <span class=\"token key atrule\">app.kubernetes.io/component</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n    <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> kafka\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">service.alpha.kubernetes.io/tolerate-unready-endpoints</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> broker\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9092</span>\n  <span class=\"token key atrule\">clusterIP</span><span class=\"token punctuation\">:</span> None\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app.kubernetes.io/component</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n    <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> kafka</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id=\"StatefulSet-1\" style=\"position:relative;\">StatefulSet<a href=\"#StatefulSet-1\" aria-label=\"StatefulSet 1 permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h3>\n<p><strong>statefulset.yaml</strong></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"99354119472610890000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: kafka\n  namespace: <your-namespace>\n  labels:\n    helm.sh/chart: kafka-0.20.5\n    app.kubernetes.io/managed-by: Helm\n    app.kubernetes.io/component: kafka-broker\n    app.kubernetes.io/name: kafka\n    app.kubernetes.io/instance: kafka\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/component: kafka-broker\n      app.kubernetes.io/name: kafka\n      app.kubernetes.io/instance: kafka\n  serviceName: kafka-headless\n  podManagementPolicy: OrderedReady\n  updateStrategy:\n    type: OnDelete\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        helm.sh/chart: kafka-0.20.5\n        app.kubernetes.io/managed-by: Helm\n        app.kubernetes.io/component: kafka-broker\n        app.kubernetes.io/name: kafka\n        app.kubernetes.io/instance: kafka\n    spec:\n      containers:\n        - name: kafka-broker\n          image: &quot;confluentinc/cp-kafka:5.0.1&quot;\n          imagePullPolicy: &quot;IfNotPresent&quot;\n          resources:\n            requests:\n              cpu: 200m\n              memory: 1Gi\n            limits:\n              cpu: 1000m\n              memory: 1Gi\n          livenessProbe:\n            exec:\n              command:\n                - sh\n                - -ec\n                - /usr/bin/jps | /bin/grep -q SupportedKafka\n            initialDelaySeconds: 30\n            timeoutSeconds: 5\n          readinessProbe:\n            tcpaSocket:\n              port: kafka\n            initialDelaySeconds: 30\n            periodSeconds: 10\n            timeoutSeconds: 5\n            successThreshold: 1\n            failureThreshold: 3\n          ports:\n            - containerPort: 9092\n              name: kafka\n          env:\n            - name: POD_IP\n              valueFrom:\n                fieldRef:\n                  fieldPath: status.podIP\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: KAFKA_HEAP_OPTS\n              value: -Xmx512m -Xms512m\n            - name: KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR\n              value: &quot;2&quot;\n            - name: KAFKA_ZOOKEEPER_CONNECT\n              value: &quot;kafka-zookeeper:2181&quot;\n            - name: KAFKA_LOG_DIRS\n              value: &quot;/opt/kafka/data/logs&quot;\n            - name: &quot;KAFKA_CONFLUENT_SUPPORT_METRICS_ENABLE&quot;\n              value: &quot;false&quot;\n            - name: KAFKA_JMX_PORT\n              value: &quot;5555&quot;\n          # This is required because the Downward API does not yet support identification of\n          # pod numbering in statefulsets. Thus, we are required to specify a command which\n          # allows us to extract the pod ID for usage as the Kafka Broker ID.\n          # See: https://github.com/kubernetes/kubernetes/issues/31218\n          command:\n            - sh\n            - -exc\n            - |\n              unset KAFKA_PORT && \\\n              export KAFKA_BROKER_ID=\\${POD_NAME##*-} && \\\n              export KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://\\${POD_IP}:9092 && \\\n              exec /etc/confluent/docker/run\n          volumeMounts:\n            - name: datadir\n              mountPath: &quot;/opt/kafka/data&quot;\n      terminationGracePeriodSeconds: 60\n  volumeClaimTemplates:\n    - metadata:\n        name: datadir\n      spec:\n        accessModes: [&quot;ReadWriteOnce&quot;]\n        storageClassName: &quot;ebs-default&quot;\n        resources:\n          requests:\n            storage: 20Gi`, `99354119472610890000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StatefulSet\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">helm.sh/chart</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>0.20.5\n    <span class=\"token key atrule\">app.kubernetes.io/managed-by</span><span class=\"token punctuation\">:</span> Helm\n    <span class=\"token key atrule\">app.kubernetes.io/component</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n    <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> kafka\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app.kubernetes.io/component</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n      <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> kafka\n      <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> kafka\n  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>headless\n  <span class=\"token key atrule\">podManagementPolicy</span><span class=\"token punctuation\">:</span> OrderedReady\n  <span class=\"token key atrule\">updateStrategy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> OnDelete\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">helm.sh/chart</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>0.20.5\n        <span class=\"token key atrule\">app.kubernetes.io/managed-by</span><span class=\"token punctuation\">:</span> Helm\n        <span class=\"token key atrule\">app.kubernetes.io/component</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n        <span class=\"token key atrule\">app.kubernetes.io/name</span><span class=\"token punctuation\">:</span> kafka\n        <span class=\"token key atrule\">app.kubernetes.io/instance</span><span class=\"token punctuation\">:</span> kafka\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>broker\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"confluentinc/cp-kafka:5.0.1\"</span>\n          <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"IfNotPresent\"</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 200m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 1Gi\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 1000m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 1Gi\n          <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> sh\n                <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>ec\n                <span class=\"token punctuation\">-</span> /usr/bin/jps <span class=\"token punctuation\">|</span> /bin/grep <span class=\"token punctuation\">-</span>q SupportedKafka\n            <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n            <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n          <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">tcpaSocket</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> kafka\n            <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30</span>\n            <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n            <span class=\"token key atrule\">timeoutSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n            <span class=\"token key atrule\">successThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n            <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">9092</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> POD_IP\n              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">fieldRef</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">fieldPath</span><span class=\"token punctuation\">:</span> status.podIP\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> POD_NAME\n              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">fieldRef</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">fieldPath</span><span class=\"token punctuation\">:</span> metadata.name\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> POD_NAMESPACE\n              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">fieldRef</span><span class=\"token punctuation\">:</span>\n                  <span class=\"token key atrule\">fieldPath</span><span class=\"token punctuation\">:</span> metadata.namespace\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> KAFKA_HEAP_OPTS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">-</span>Xmx512m <span class=\"token punctuation\">-</span>Xms512m\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> KAFKA_ZOOKEEPER_CONNECT\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"kafka-zookeeper:2181\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> KAFKA_LOG_DIRS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/opt/kafka/data/logs\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"KAFKA_CONFLUENT_SUPPORT_METRICS_ENABLE\"</span>\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> KAFKA_JMX_PORT\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5555\"</span>\n          <span class=\"token comment\"># This is required because the Downward API does not yet support identification of</span>\n          <span class=\"token comment\"># pod numbering in statefulsets. Thus, we are required to specify a command which</span>\n          <span class=\"token comment\"># allows us to extract the pod ID for usage as the Kafka Broker ID.</span>\n          <span class=\"token comment\"># See: https://github.com/kubernetes/kubernetes/issues/31218</span>\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> sh\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>exc\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n              unset KAFKA_PORT &amp;&amp; \\\n              export KAFKA_BROKER_ID=${POD_NAME##*-} &amp;&amp; \\\n              export KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://${POD_IP}:9092 &amp;&amp; \\\n              exec /etc/confluent/docker/run</span>\n          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> datadir\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/opt/kafka/data\"</span>\n      <span class=\"token key atrule\">terminationGracePeriodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n  <span class=\"token key atrule\">volumeClaimTemplates</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> datadir\n      <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"ReadWriteOnce\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ebs-default\"</span>\n        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 20Gi</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>kafka.yaml</strong></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"46870766849554270000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`<insert service-brokers.yaml>\n---\n<insert service-headless.yaml>\n---\n<insert statefulset.yaml>`, `46870766849554270000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\">&lt;insert service<span class=\"token punctuation\">-</span>brokers.yaml<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">---</span>\n&lt;insert service<span class=\"token punctuation\">-</span>headless.yaml<span class=\"token punctuation\">></span>\n<span class=\"token punctuation\">---</span>\n&lt;insert statefulset.yaml<span class=\"token punctuation\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"80852285370668170000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kubectl apply -f kafka.yaml`, `80852285370668170000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kubectl apply -f kafka.yaml</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 795px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/be0bd095f8c9077362baadbe16f22c20/396d0/apply-kafka.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.625%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/be0bd095f8c9077362baadbe16f22c20/396d0/apply-kafka.jpg\"\n        srcset=\"/static/be0bd095f8c9077362baadbe16f22c20/a3e66/apply-kafka.jpg 480w,\n/static/be0bd095f8c9077362baadbe16f22c20/396d0/apply-kafka.jpg 795w\"\n        sizes=\"(max-width: 795px) 100vw, 795px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"Kafka-Manager\" style=\"position:relative;\">Kafka Manager<a href=\"#Kafka-Manager\" aria-label=\"Kafka Manager permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p><strong>Kafka Manager</strong>(카프카 매니저)는 GUI 기반 카프카 관리 도구입니다. 대다수 카프카 작업을 CLI로 관리하는 것은 가독성이 낮아 비효율적이기 때문에 편의적인 측면에서 필수적으로 설치하는 것을 권장합니다.</p>\n<p>주키퍼 파드에 접속하여 <strong>zkCli</strong>(주키퍼 클라이언트)를 실행해 봅시다. 파드 3개 중 아무 파드에 접속해도 무방합니다. 필자는 <code>kafka-zookeeper-0</code> 파드에 접속하였습니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"19240051893409935000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kubectl exec -it kafka-zookeeper-0 --namesapce=<your-namespace> bash\nzkCli.sh`, `19240051893409935000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kubectl <span class=\"token builtin class-name\">exec</span> -it kafka-zookeeper-0 --namesapce<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-namespace<span class=\"token operator\">></span> <span class=\"token function\">bash</span>\nzkCli.sh</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p><code>kafka-manager</code> 노드를 생성합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"56053524500237480000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`[zk: localhost:2181(CONNECTED) 0] create /kafka-manager`, `56053524500237480000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token punctuation\">[</span>zk: localhost:2181<span class=\"token punctuation\">(</span>CONNECTED<span class=\"token punctuation\">)</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span> create /kafka-manager</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 795px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/17a0544603256fb05ecae78958f083d1/396d0/create-node-for-kafka-manager.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 175.41666666666666%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/17a0544603256fb05ecae78958f083d1/396d0/create-node-for-kafka-manager.jpg\"\n        srcset=\"/static/17a0544603256fb05ecae78958f083d1/a3e66/create-node-for-kafka-manager.jpg 480w,\n/static/17a0544603256fb05ecae78958f083d1/396d0/create-node-for-kafka-manager.jpg 795w\"\n        sizes=\"(max-width: 795px) 100vw, 795px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><strong>kafka-manager.yaml</strong></p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"55058243256043690000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`apiVersion: v1\nkind: Service\nmetadata:\n  name: kafka-manager\n  namespace: <your-namespace>\nspec:\n  selector:\n    app: kafka-manager\n  ports:\n    - protocol: TCP\n      port: 80\n      targetPort: 80\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: kafka-manager\n  namespace: <your-namespace>\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: kafka-manager\n  template:\n    metadata:\n      labels:\n        app: kafka-manager\n    spec:\n      containers:\n        - name: kafka-manager\n          image: solsson/kafka-manager@sha256:9da595ecbb733074a1d3c6091a1e0c384da4f4e1f19f4e16276062278da8e592\n          ports:\n            - containerPort: 80\n          env:\n            - name: ZK_HOSTS\n              value: &quot;kafka-zookeeper:2181/kafka-manager&quot;\n          command:\n            - ./bin/kafka-manager\n            - -Dhttp.port=80\n          resources:\n            limits:\n              cpu: 500m\n              memory: 512Mi\n            requests:\n              cpu: 100m\n              memory: 384Mi`, `55058243256043690000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>manager\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>manager\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>manager\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> &lt;your<span class=\"token punctuation\">-</span>namespace<span class=\"token punctuation\">></span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>manager\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>manager\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> kafka<span class=\"token punctuation\">-</span>manager\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> solsson/kafka<span class=\"token punctuation\">-</span>manager@sha256<span class=\"token punctuation\">:</span>9da595ecbb733074a1d3c6091a1e0c384da4f4e1f19f4e16276062278da8e592\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ZK_HOSTS\n              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"kafka-zookeeper:2181/kafka-manager\"</span>\n          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> ./bin/kafka<span class=\"token punctuation\">-</span>manager\n            <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>Dhttp.port=80\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 500m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 512Mi\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 384Mi</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p><code>image</code> 필드의 경우 <a href=\"https://hub.docker.com/r/solsson/kafka-manager\">Kafka Docker Builds</a> 컨테이너 이미지를 사용하였습니다. Docker Hub 사이트에서 <a href=\"https://hub.docker.com/search?q=kafka-manager&#x26;type=image\">Explore</a> 검색을 통해 다른 이미지를 사용해도 무방합니다.</p>\n</blockquote>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"6188583949191773000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kubectl apply -f kafka-manager.yaml`, `6188583949191773000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kubectl apply -f kafka-manager.yaml</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 795px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ca57d755d59417dfeaefa8ea57e96c6a/396d0/apply-kafka-manager.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.750000000000002%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/ca57d755d59417dfeaefa8ea57e96c6a/396d0/apply-kafka-manager.jpg\"\n        srcset=\"/static/ca57d755d59417dfeaefa8ea57e96c6a/a3e66/apply-kafka-manager.jpg 480w,\n/static/ca57d755d59417dfeaefa8ea57e96c6a/396d0/apply-kafka-manager.jpg 795w\"\n        sizes=\"(max-width: 795px) 100vw, 795px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>쿠버네티스의 API 서버로 프록시하는 명령어를 입력해서 카프카 매니저 웹 서비스에 접속해 봅시다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"6491548741761322000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kubectl proxy`, `6491548741761322000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kubectl proxy</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 795px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2ad9b563105a54c42e8aa06911dceaf2/396d0/proxy.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.249999999999998%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/2ad9b563105a54c42e8aa06911dceaf2/396d0/proxy.jpg\"\n        srcset=\"/static/2ad9b563105a54c42e8aa06911dceaf2/a3e66/proxy.jpg 480w,\n/static/2ad9b563105a54c42e8aa06911dceaf2/396d0/proxy.jpg 795w\"\n        sizes=\"(max-width: 795px) 100vw, 795px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>브라우저에서 <a href=\"\">http://127.0.0.1:8001/api/v1/namespaces/<code>&#x3C;your-namespace></code>/services/http:kafka-manager:80/proxy/</a> 접속 후 다음과 같은 화면이 보인다면 카프카 매니저가 잘 구동된 것입니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 645px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4fafa4781cc0ceafc2dae7b715cb7267/49419/kafka-manager.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.29166666666666%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/4fafa4781cc0ceafc2dae7b715cb7267/49419/kafka-manager.jpg\"\n        srcset=\"/static/4fafa4781cc0ceafc2dae7b715cb7267/a3e66/kafka-manager.jpg 480w,\n/static/4fafa4781cc0ceafc2dae7b715cb7267/49419/kafka-manager.jpg 645w\"\n        sizes=\"(max-width: 645px) 100vw, 645px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code>kafka-manager</code> 노드를 생성하지 않으면 다음과 같은 오류 문구를 화면에 표시합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1920px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d6111e5fcd2c00266c11d0983b6b3dea/83ca0/kafka-manager-failed.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.75%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/d6111e5fcd2c00266c11d0983b6b3dea/aaf92/kafka-manager-failed.jpg\"\n        srcset=\"/static/d6111e5fcd2c00266c11d0983b6b3dea/a3e66/kafka-manager-failed.jpg 480w,\n/static/d6111e5fcd2c00266c11d0983b6b3dea/fb816/kafka-manager-failed.jpg 960w,\n/static/d6111e5fcd2c00266c11d0983b6b3dea/aaf92/kafka-manager-failed.jpg 1920w,\n/static/d6111e5fcd2c00266c11d0983b6b3dea/83ca0/kafka-manager-failed.jpg 2001w\"\n        sizes=\"(max-width: 1920px) 100vw, 1920px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>오류 문구에 당황하지 마시고 주키퍼 클라이언트에서 해당 노드를 생성한 후 다음 명령어를 입력해 파드를 삭제하세요. 쿠버네티스의 <code>delete</code> 명령어로 파드를 삭제하면 새로운 파드를 다시 생성하기 때문에 <code>restart</code> 개념과 유사합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"74632056070436080000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kubectl delete pod/<kafka-manager-pod> --namespace=<your-namespace>`, `74632056070436080000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kubectl delete pod/<span class=\"token operator\">&lt;</span>kafka-manager-pod<span class=\"token operator\">></span> --namespace<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-namespace<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>Kafka Manager - Cluster - Add Cluster 버튼을 클릭하여 새 클러스터를 추가해 봅시다. 클러스터를 생성하는 목적은 카프카 매니저에서 토픽을 관리하기 위한 것으로 카프카, 주키퍼 클러스터와는 무관합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 660px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/22e9f4cdf96b211b7a3f87b34d3bba82/5ab81/create-kafka-manager-cluster.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 455.83333333333337%; position: relative; bottom: 0; left: 0; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"\"\n        title=\"\"\n        src=\"/static/22e9f4cdf96b211b7a3f87b34d3bba82/5ab81/create-kafka-manager-cluster.jpg\"\n        srcset=\"/static/22e9f4cdf96b211b7a3f87b34d3bba82/a3e66/create-kafka-manager-cluster.jpg 480w,\n/static/22e9f4cdf96b211b7a3f87b34d3bba82/5ab81/create-kafka-manager-cluster.jpg 660w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li><strong>JMX</strong>(Java Management eXtensions): 실행 중인 애플리케이션의 정상 동작 여부 및 상태를 관리하는 API</li>\n<li><strong>Polling</strong>(폴링): 동기화 처리 등을 목적으로 다른 애플리케이션의 상태를 주기적으로 검사하여 일정한 조건을 만족할 때 송수신 등의 자료 처리를 하는 방식</li>\n</ul>\n<p>카프카 매니저 클러스터 생성을 완료하였습니다. 이제 카프카 매니저로 토픽을 관리해 봅시다.</p>\n<h2 id=\"Topic\" style=\"position:relative;\">Topic<a href=\"#Topic\" aria-label=\"Topic permalink\" class=\"icon-heading-link after\"><svg viewBox=\"0 0 24 24\" height=\"24\" aria-hidden=\"true\"><path d=\"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z\"></path></svg></a></h2>\n<p>Kafka <strong>Topic</strong>(토픽)은 메시지를 저장하는 곳입니다. 카프카의 브로커는 토픽을 기준으로 메시지를 관리합니다. 카프카 파드에 접속해 봅시다. 실제 토픽은 주키퍼에 저장하고 카프카는 참조만 하기 때문에 파드 3개 중 아무 파드에 접속해도 무방합니다. 필자는 <code>kafka-0</code> 파드에 접속하였습니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"23041291042421120000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kubectl exec -it kafka-0 --namespace=<your-namespace> bash`, `23041291042421120000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kubectl <span class=\"token builtin class-name\">exec</span> -it kafka-0 --namespace<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>your-namespace<span class=\"token operator\">></span> <span class=\"token function\">bash</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>토픽을 생성합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"69757714467166170000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kafka-topics --zookeeper kafka-zookeeper:2181 --create --topic <insert-your-topic-name> --partitions 3 --replication-factor 2`, `69757714467166170000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kafka-topics --zookeeper kafka-zookeeper:2181 --create --topic <span class=\"token operator\">&lt;</span>insert-your-topic-name<span class=\"token operator\">></span> --partitions <span class=\"token number\">3</span> --replication-factor <span class=\"token number\">2</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<ul>\n<li><code>--partitions</code>: 토픽을 몇 개의 파티션으로 나눌 것인지 정의합니다. 메시지 병목 현상을 방지하기 위해 하나의 토픽을 여러 개의 파티션으로 나누어 병렬 형태로 작업하는 것이 좋습니다.</li>\n<li><code>--replication-factor</code>: 메시지를 몇 개로 복제할 것인지 정의합니다. 안정성을 위하여 2로 설정하는 것을 권장합니다.</li>\n</ul>\n<p>토픽을 여러 개 생성할 때는 명령문 마지막에 <code>;</code>(세미콜론)을 추가합니다. <code>\\</code>(백슬래시)를 활용하면 줄 바꿈을 적용하여 즉시 실행을 방지합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"24060543903061803000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kafka-topics --zookeeper kafka-zookeeper:2181 --create --topic <insert-your-topic-name> --partitions 3 --replication-factor 2; \\\nkafka-topics --zookeeper kafka-zookeeper:2181 --create --topic <insert-your-topic-name> --partitions 3 --replication-factor 2;`, `24060543903061803000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kafka-topics --zookeeper kafka-zookeeper:2181 --create --topic <span class=\"token operator\">&lt;</span>insert-your-topic-name<span class=\"token operator\">></span> --partitions <span class=\"token number\">3</span> --replication-factor <span class=\"token number\">2</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\nkafka-topics --zookeeper kafka-zookeeper:2181 --create --topic <span class=\"token operator\">&lt;</span>insert-your-topic-name<span class=\"token operator\">></span> --partitions <span class=\"token number\">3</span> --replication-factor <span class=\"token number\">2</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>토픽을 확인합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"20004460039925174000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kafka-topics --zookeeper kafka-zookeeper:2181 --list`, `20004460039925174000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kafka-topics --zookeeper kafka-zookeeper:2181 --list</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>토픽을 삭제합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"36964920320375970000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kafka-topics --zookeeper kafka-zookeeper:2181 --delete --topic <insert-your-topic-name>`, `36964920320375970000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kafka-topics --zookeeper kafka-zookeeper:2181 --delete --topic <span class=\"token operator\">&lt;</span>insert-your-topic-name<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>토픽에 저장된 메시지를 확인합니다.</p>\n<div\n              class=\"gatsby-code-button-container\"\n              data-toaster-id=\"13912299114929971000\"\n              data-toaster-class=\"gatsby-code-button-toaster\"\n              data-toaster-text-class=\"gatsby-code-button-toaster-text\"\n              data-toaster-text=\"코드 내용을 복사하였습니다.\"\n              data-toaster-duration=\"3500\"\n              onClick=\"copyToClipboard(`kafka-console-consumer --bootstrap-server kafka:9092 --topic <your-topic-name>`, `13912299114929971000`)\"\n            >\n              <div\n                class=\"gatsby-code-button\"\n                data-tooltip=\"\"\n              >\n                <svg viewBox=\"0 0 24 24\"><path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\"></path></svg>\n              </div>\n            </div>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">kafka-console-consumer --bootstrap-server kafka:9092 --topic <span class=\"token operator\">&lt;</span>your-topic-name<span class=\"token operator\">></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","tableOfContents":"<ul>\n<li><a href=\"#%EB%AA%A9%EC%B0%A8\">목차</a></li>\n<li><a href=\"#zookeeper\">ZooKeeper</a></li>\n<li><a href=\"#service\">Service</a></li>\n<li><a href=\"#statefulset\">StatefulSet</a></li>\n<li><a href=\"#kafka\">Kafka</a></li>\n<li><a href=\"#kafka-manager\">Kafka Manager</a></li>\n<li><a href=\"#topic\">Topic</a></li>\n</ul>","frontmatter":{"category":"kubernetes","index":9,"title":"Apache Kafka","description":"Apache Kafka(아파치 카프카)는 오픈 소스 대규모 메시지 플랫폼입니다. 모빌리티 스타트업에서 차량의 패킷을 실시간으로 수집하는 데 사용하였습니다.","image":"kafka","date":"2020-05-25"}},"prevPost":{"fields":{"slug":"/post/kubernetes/drone/"},"frontmatter":{"category":"kubernetes","title":"Drone CI"}},"nextPost":{"fields":{"slug":"/post/developer/wakatime-vs-codetime/"},"frontmatter":{"category":"developer","title":"WakaTime vs CodeTime 🕖"}}},"pageContext":{"id":"ab9ade26-27a9-56bb-b934-e9f48bdc0237","prevPostID":"5dd1589e-3eef-5561-accf-bbe44538f5d1","nextPostID":"cf389a5a-6187-5fa9-a410-b0d81b95f2b4"}},
    "staticQueryHashes": ["1955143157","2731891648"]}